"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.vulnerabilityPatterns = void 0;
exports.vulnerabilityPatterns = [
    //
    // INJECTION VULNERABILITIES
    //
    {
        type: 'SQL Injection',
        severity: 'critical',
        regex: /["'`]\s*\+\s*.*?\s*\+\s*["'`]|f["']SELECT.*?FROM.*?\{.*?\}|execute\(.*?\+.*?\)|query\(.*?\+.*?\)/gi,
        languages: ['python', 'javascript', 'typescript', 'java', 'php'],
        message: 'Potential SQL Injection vulnerability detected',
        explanation: 'String concatenation in SQL queries allows attackers to inject malicious SQL commands.',
        fix: 'Use parameterized queries or prepared statements.',
        codeExample: `// Bad: "SELECT * FROM users WHERE id = '" + userId + "'"\n// Good: execute("SELECT * FROM users WHERE id = ?", [userId])`,
        cwe: 'CWE-89'
    },
    {
        type: 'Command Injection',
        severity: 'critical',
        regex: /exec\(.*?\+|system\(.*?\+|shell_exec\(.*?\+|eval\(.*?\+|subprocess\.(call|run|Popen)\(.*?\+/gi,
        languages: ['python', 'javascript', 'typescript', 'php', 'java'],
        message: 'Potential Command Injection vulnerability',
        explanation: 'Executing system commands with unsanitized data allows arbitrary command execution.',
        fix: 'Avoid dynamic command execution.',
        codeExample: `// Bad: exec('ls ' + userInput)\n// Good: execFile('ls', [safeInput])`,
        cwe: 'CWE-78'
    },
    {
        type: 'NoSQL Injection',
        severity: 'critical',
        regex: /find\(\{.*?\$where.*?\}\)|find\(\{.*?req\.(body|query|params)/gi,
        languages: ['javascript', 'typescript'],
        message: 'Potential NoSQL Injection vulnerability',
        explanation: 'Passing user input directly into NoSQL queries can lead to privilege escalation.',
        fix: 'Validate and sanitize input.',
        codeExample: `// Bad: db.find({$where: userInput})\n// Good: db.find({name: sanitize(userInput)})`,
        cwe: 'CWE-943'
    },
    //
    // XSS VULNERABILITIES
    //
    {
        type: 'Cross-Site Scripting (XSS)',
        severity: 'high',
        regex: /\.innerHTML\s*=|dangerouslySetInnerHTML|document\.write\(|\.outerHTML\s*=/gi,
        languages: ['javascript', 'typescript'],
        message: 'Potential XSS vulnerability detected',
        explanation: 'Directly inserting HTML exposes your site to script injection.',
        fix: 'Use textContent or sanitize HTML.',
        codeExample: `// Bad: el.innerHTML = user\n// Good: el.textContent = user`,
        cwe: 'CWE-79'
    },
    {
        type: 'DOM-based XSS',
        severity: 'high',
        regex: /document\.location|window\.location\.href.*?=|document\.URL|document\.referrer/gi,
        languages: ['javascript', 'typescript'],
        message: 'Potential DOM-based XSS',
        explanation: 'Unsafe use of document.location can lead to execution of malicious scripts.',
        fix: 'Validate and encode URLs.',
        codeExample: `// Good: element.textContent = new URL(document.location).pathname`,
        cwe: 'CWE-79'
    },
    //
    // AUTHENTICATION / SECRETS
    //
    {
        type: 'Hardcoded Secret',
        severity: 'critical',
        regex: /(api[_-]?key|password|secret|token|private[_-]?key)\s*[:=]\s*["'][^"']{10,}["']/gi,
        languages: ['*'],
        message: 'Hardcoded secret detected',
        explanation: 'Secrets in code can leak through repos and logs.',
        fix: 'Use environment variables or secret managers.',
        codeExample: `// Bad: const key = "sk-123..."\n// Good: const key = process.env.KEY`,
        cwe: 'CWE-798'
    },
    {
        type: 'Weak Password Storage',
        severity: 'critical',
        regex: /password\s*=\s*.*?\.encode\(\)|hashlib\.md5|hashlib\.sha1/gi,
        languages: ['python', 'javascript', 'typescript', 'java'],
        message: 'Weak password hashing detected',
        explanation: 'MD5 and SHA1 are not secure for password hashing.',
        fix: 'Use bcrypt, scrypt, or Argon2.',
        codeExample: `// Bad: md5(password)\n// Good: bcrypt.hash(password, salt)`,
        cwe: 'CWE-916'
    },
    //
    // CRYPTOGRAPHY
    //
    {
        type: 'Weak Cryptographic Algorithm',
        severity: 'high',
        regex: /\bMD5\b|\bSHA1\b|\bDES\b|\bRC4\b|\bRC2\b/gi,
        languages: ['*'],
        message: 'Weak cryptographic algorithm detected',
        explanation: 'These algorithms are broken and unsafe.',
        fix: 'Use SHA-256 or AES-256.',
        codeExample: `// Bad: crypto.createHash('md5')\n// Good: crypto.createHash('sha256')`,
        cwe: 'CWE-327'
    },
    {
        type: 'Insecure Random',
        severity: 'medium',
        regex: /Math\.random\(\)|random\.random\(\)|rand\(\)/gi,
        languages: ['javascript', 'typescript', 'python', 'php'],
        message: 'Insecure random generator',
        explanation: 'Non-cryptographic random functions are predictable.',
        fix: 'Use crypto.randomBytes or secrets module.',
        codeExample: `// Good: crypto.randomBytes(32)`,
        cwe: 'CWE-338'
    },
    //
    // FILE & PATH
    //
    {
        type: 'Path Traversal',
        severity: 'high',
        regex: /open\(.*?\+|readFile\(.*?\+|path\.join\(.*?req\./gi,
        languages: ['python', 'javascript', 'typescript', 'java'],
        message: 'Potential path traversal vulnerability',
        explanation: 'User-controlled paths can escape directories.',
        fix: 'Validate and sanitize file paths.',
        codeExample: `// Good: path.basename(userPath)`,
        cwe: 'CWE-22'
    },
    {
        type: 'Arbitrary File Upload',
        severity: 'high',
        regex: /multer\(\)\.single|upload\.single|files\[.*?\]\.mv\(/gi,
        languages: ['javascript', 'typescript', 'php'],
        message: 'Unrestricted file upload',
        explanation: 'Upload of executables can lead to RCE.',
        fix: 'Whitelist file types & check MIME types.',
        codeExample: `// Good: validate allowed file types`,
        cwe: 'CWE-434'
    },
    //
    // DESERIALIZATION
    //
    {
        type: 'Insecure Deserialization',
        severity: 'critical',
        regex: /pickle\.loads|yaml\.load\(|unserialize\(|ObjectInputStream/gi,
        languages: ['python', 'java', 'php'],
        message: 'Insecure deserialization detected',
        explanation: 'Deserializing untrusted data can lead to RCE.',
        fix: 'Use safe loaders like yaml.safe_load.',
        codeExample: `// Good: json.loads(user_data)`,
        cwe: 'CWE-502'
    },
    //
    // WEB SECURITY
    //
    {
        type: 'CORS Misconfiguration',
        severity: 'medium',
        regex: /Access-Control-Allow-Origin.*?\*/gi,
        languages: ['javascript', 'typescript', 'python', 'java', 'php'],
        message: 'Overly permissive CORS policy',
        explanation: 'Using * exposes private data to any website.',
        fix: 'Restrict origins.',
        codeExample: `// Good: Access-Control-Allow-Origin: https://trusted.com`,
        cwe: 'CWE-942'
    },
    {
        type: 'Missing Security Headers',
        severity: 'medium',
        regex: /helmet\(\)|X-Frame-Options|Content-Security-Policy|Strict-Transport-Security/gi,
        languages: ['javascript', 'typescript'],
        message: 'Missing security headers',
        explanation: 'Security headers protect against common attacks.',
        fix: 'Enable Helmet or set headers manually.',
        codeExample: `// Good: app.use(helmet())`,
        cwe: 'CWE-693'
    },
    {
        type: 'Open Redirect',
        severity: 'medium',
        regex: /redirect\(.*?req\.(query|body|params)|header\('Location',.*?\+/gi,
        languages: ['javascript', 'typescript', 'python', 'java', 'php'],
        message: 'Potential open redirect vulnerability',
        explanation: 'Redirects using user input enable phishing attacks.',
        fix: 'Validate redirect URLs.',
        codeExample: `// Good: allowlist redirect URLs`,
        cwe: 'CWE-601'
    },
    //
    // REGEX DOS
    //
    {
        type: 'ReDoS (Regular Expression Denial of Service)',
        severity: 'medium',
        regex: /new RegExp\(.*?\+|RegExp\(.*?req\./gi,
        languages: ['javascript', 'typescript', 'python'],
        message: 'Potential ReDoS vulnerability',
        explanation: 'User-controlled regex can freeze the system.',
        fix: 'Never allow user input in regex patterns.',
        codeExample: `// Good: use predefined patterns`,
        cwe: 'CWE-1333'
    },
    //
    // FRAMEWORK SPECIFIC
    //
    {
        type: 'React dangerouslySetInnerHTML',
        severity: 'high',
        regex: /dangerouslySetInnerHTML=\{\{__html:/gi,
        languages: ['javascript', 'typescript'],
        message: 'dangerouslySetInnerHTML used',
        explanation: 'This bypasses React XSS protections.',
        fix: 'Fully sanitize HTML before using it.',
        codeExample: `dangerouslySetInnerHTML={{__html: DOMPurify.sanitize(html)}}`,
        cwe: 'CWE-79'
    },
    {
        type: 'Express Trust Proxy',
        severity: 'low',
        regex: /app\.set\(['"]trust proxy['"]/gi,
        languages: ['javascript', 'typescript'],
        message: 'Trust proxy setting detected',
        explanation: 'Incorrect trust proxy may allow spoofed IPs.',
        fix: 'Configure trust proxy correctly.',
        codeExample: `app.set('trust proxy', 1)`,
        cwe: 'CWE-923'
    }
];
//# sourceMappingURL=vulnerabilityPatterns.js.map